# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

## æ¦‚è¦

DevCorpTrends ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ä¼æ¥­å½±éŸ¿åŠ›åˆ†æã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã§ã™ã€‚
æŠ€è¡“ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã®ä¼æ¥­ã®å½±éŸ¿åŠ›ã‚’å®šé‡åŒ–ã—ã€è¤‡æ•°æœŸé–“ã§ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

## è¨­è¨ˆæ–¹é‡

- **ä¼æ¥­åˆ†æç‰¹åŒ–**: ä¼æ¥­ã®æŠ€è¡“ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã®å½±éŸ¿åŠ›æ¸¬å®šã«ç‰¹åŒ–
- **ã‚·ãƒ³ãƒ—ãƒ«è¨­è¨ˆ**: 7ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚ˆã‚‹æœ€å°é™ã‹ã¤ååˆ†ãªè¨­è¨ˆ
- **é•·æœŸãƒ‡ãƒ¼ã‚¿ä¿æŒ**: éå»ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šä¿å­˜ã«ã‚ˆã‚‹æ™‚ç³»åˆ—åˆ†æ
- **è¤‡æ•°æœŸé–“åˆ†æ**: 1é€±é–“ã€œå…¨æœŸé–“ã®7ã¤ã®æœŸé–“åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°

## ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

### 1. ä¼æ¥­ãƒ†ãƒ¼ãƒ–ãƒ« (companies)

ä¼æ¥­ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE companies (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    domain VARCHAR(255) NOT NULL UNIQUE,
    description TEXT NULL,
    logo_url VARCHAR(500) NULL,
    website_url VARCHAR(500) NULL,
    qiita_username VARCHAR(255) NULL,    -- Qiitaãƒ¦ãƒ¼ã‚¶ãƒ¼å
    zenn_username VARCHAR(255) NULL,     -- Zennãƒ¦ãƒ¼ã‚¶ãƒ¼å
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ« (platforms)

ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¯¾è±¡ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã‚’ç®¡ç†

```sql
CREATE TABLE platforms (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    base_url VARCHAR(500) NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 3. è¨˜äº‹ãƒ†ãƒ¼ãƒ–ãƒ« (articles)

å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å–å¾—ã—ãŸè¨˜äº‹æƒ…å ±ã‚’ä¿å­˜

```sql
CREATE TABLE articles (
    id BIGSERIAL PRIMARY KEY,
    platform_id BIGINT NULL REFERENCES platforms(id), -- nullable for legacy compatibility
    company_id BIGINT NULL REFERENCES companies(id),   -- nullable for unidentified companies
    title VARCHAR(500) NOT NULL,
    url VARCHAR(1000) NOT NULL UNIQUE,
    domain VARCHAR(255) NULL,          -- extracted domain from URL
    platform VARCHAR(100) NULL,       -- platform identifier string
    author_name VARCHAR(255) NULL,     -- å–å¾—ã§ããªã„å ´åˆãŒã‚ã‚‹
    author VARCHAR(255) NULL,          -- æŠ•ç¨¿è€…æƒ…å ±ï¼ˆQiitaç”¨ï¼‰
    author_url VARCHAR(500) NULL,      -- æŠ•ç¨¿è€…URLï¼ˆQiitaç”¨ï¼‰
    published_at TIMESTAMP NULL,       -- å–å¾—ã§ããªã„å ´åˆãŒã‚ã‚‹
    bookmark_count INTEGER NOT NULL DEFAULT 0,
    likes_count INTEGER NOT NULL DEFAULT 0,  -- ã„ã„ã­æ•°ï¼ˆQiitaç”¨ï¼‰
    scraped_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 4. ä¼æ¥­å½±éŸ¿åŠ›ã‚¹ã‚³ã‚¢ãƒ†ãƒ¼ãƒ–ãƒ« (company_influence_scores)

ä¼æ¥­ã®å½±éŸ¿åŠ›ã‚¹ã‚³ã‚¢ã‚’æœŸé–“åˆ¥ã«é›†è¨ˆãƒ»ä¿å­˜

```sql
CREATE TABLE company_influence_scores (
    id BIGSERIAL PRIMARY KEY,
    company_id BIGINT NOT NULL REFERENCES companies(id),
    period_type VARCHAR(50) NOT NULL, -- daily, weekly, monthly
    period_start DATE NOT NULL,
    period_end DATE NOT NULL,
    total_score DECIMAL(10,2) NOT NULL,
    article_count INTEGER NOT NULL DEFAULT 0,
    total_bookmarks INTEGER NOT NULL DEFAULT 0,
    calculated_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 5. ä¼æ¥­ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ« (company_rankings)

å„æœŸé–“ã«ãŠã‘ã‚‹ä¼æ¥­ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°æƒ…å ±ã‚’ä¿å­˜

```sql
CREATE TABLE company_rankings (
    id BIGSERIAL PRIMARY KEY,
    company_id BIGINT NOT NULL REFERENCES companies(id),
    ranking_period VARCHAR(10) NOT NULL, -- 1w, 1m, 3m, 6m, 1y, 3y, all
    rank_position INTEGER NOT NULL,
    total_score DECIMAL(10,2) NOT NULL,
    article_count INTEGER NOT NULL DEFAULT 0,
    total_bookmarks INTEGER NOT NULL DEFAULT 0,
    period_start DATE NOT NULL,
    period_end DATE NOT NULL,
    calculated_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 6. ä¼æ¥­ãƒ©ãƒ³ã‚­ãƒ³ã‚°å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ« (company_ranking_histories)

ä¼æ¥­ã®é †ä½å¤‰å‹•å±¥æ­´ã‚’è¨˜éŒ²

```sql
CREATE TABLE company_ranking_histories (
    id BIGSERIAL PRIMARY KEY,
    company_id BIGINT NOT NULL REFERENCES companies(id),
    ranking_period VARCHAR(10) NOT NULL,
    rank_position INTEGER NOT NULL,
    rank_change INTEGER NOT NULL DEFAULT 0, -- å‰å›ã‹ã‚‰ã®é †ä½å¤‰å‹•
    total_score DECIMAL(10,2) NOT NULL,
    calculated_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 7. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ« (scraping_logs)

ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å‡¦ç†ã®å®Ÿè¡Œãƒ­ã‚°ã‚’ç®¡ç†

```sql
CREATE TABLE scraping_logs (
    id BIGSERIAL PRIMARY KEY,
    platform_id BIGINT NOT NULL REFERENCES platforms(id),
    started_at TIMESTAMP NOT NULL,
    finished_at TIMESTAMP NULL, -- å®Ÿè¡Œä¸­ã¯æœªè¨­å®š
    status VARCHAR(50) NOT NULL, -- success, failed, partial
    articles_scraped INTEGER NOT NULL DEFAULT 0,
    errors_count INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

## ERå›³

```mermaid
erDiagram
    companies {
        bigint id PK
        varchar name "NOT NULL"
        varchar domain "NOT NULL UNIQUE"
        text description "NULL"
        varchar logo_url "NULL"
        varchar website_url "NULL"
        varchar qiita_username "NULL"
        varchar zenn_username "NULL"
        boolean is_active "NOT NULL DEFAULT TRUE"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }
    
    platforms {
        bigint id PK
        varchar name "NOT NULL UNIQUE"
        varchar base_url "NOT NULL"
        boolean is_active "NOT NULL DEFAULT TRUE"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }
    
    articles {
        bigint id PK
        bigint platform_id "NULL FK"
        bigint company_id "NULL FK"
        varchar title "NOT NULL"
        varchar url "NOT NULL UNIQUE"
        varchar domain "NULL"
        varchar platform "NULL"
        varchar author_name "NULL"
        varchar author "NULL"
        varchar author_url "NULL"
        timestamp published_at "NULL"
        integer bookmark_count "NOT NULL DEFAULT 0"
        integer likes_count "NOT NULL DEFAULT 0"
        timestamp scraped_at "NOT NULL"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }
    
    company_influence_scores {
        bigint id PK
        bigint company_id "NOT NULL FK"
        varchar period_type "NOT NULL"
        date period_start "NOT NULL"
        date period_end "NOT NULL"
        decimal total_score "NOT NULL"
        integer article_count "NOT NULL DEFAULT 0"
        integer total_bookmarks "NOT NULL DEFAULT 0"
        timestamp calculated_at "NOT NULL"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }
    
    company_rankings {
        bigint id PK
        bigint company_id "NOT NULL FK"
        varchar ranking_period "NOT NULL"
        integer rank_position "NOT NULL"
        decimal total_score "NOT NULL"
        integer article_count "NOT NULL DEFAULT 0"
        integer total_bookmarks "NOT NULL DEFAULT 0"
        date period_start "NOT NULL"
        date period_end "NOT NULL"
        timestamp calculated_at "NOT NULL"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }
    
    company_ranking_histories {
        bigint id PK
        bigint company_id "NOT NULL FK"
        varchar ranking_period "NOT NULL"
        integer rank_position "NOT NULL"
        integer rank_change "NOT NULL DEFAULT 0"
        decimal total_score "NOT NULL"
        timestamp calculated_at "NOT NULL"
        timestamp created_at "NOT NULL"
    }
    
    scraping_logs {
        bigint id PK
        bigint platform_id "NOT NULL FK"
        timestamp started_at "NOT NULL"
        timestamp finished_at "NULL"
        varchar status "NOT NULL"
        integer articles_scraped "NOT NULL DEFAULT 0"
        integer errors_count "NOT NULL DEFAULT 0"
        timestamp created_at "NOT NULL"
        timestamp updated_at "NOT NULL"
    }
    
    companies ||--o{ articles : "has"
    platforms ||--o{ articles : "contains"
    companies ||--o{ company_influence_scores : "has"
    companies ||--o{ company_rankings : "has"
    companies ||--o{ company_ranking_histories : "has"
    platforms ||--o{ scraping_logs : "logs"
```

## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã®ä¸»è¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

```sql
-- articles ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_articles_company_published ON articles(company_id, published_at);
CREATE INDEX idx_articles_platform_scraped ON articles(platform_id, scraped_at);

-- company_rankings ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_rankings_period_rank ON company_rankings(ranking_period, rank_position);
CREATE INDEX idx_rankings_company_period ON company_rankings(company_id, ranking_period);

-- company_influence_scores ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_influence_company_period ON company_influence_scores(company_id, period_type, period_start);
```

## å®Ÿè£…æ®µéš

æ®µéšçš„ãªå®Ÿè£…ã«ã‚ˆã‚Šã€ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã¾ã™ã€‚

### Phase 1: åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆâœ… å®Ÿè£…å®Œäº†ï¼‰
1. âœ… companies
2. âœ… platforms
3. âœ… articles

### Phase 2: åˆ†æãƒ»é›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆğŸš§ ä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰
4. â³ company_influence_scores
5. â³ company_rankings
6. â³ company_ranking_histories

### Phase 3: é‹ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆğŸš§ ä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰
7. â³ scraping_logs

## ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½

### å¯¾è±¡æœŸé–“
- **1w**: 1é€±é–“
- **1m**: 1ãƒ¶æœˆ
- **3m**: 3ãƒ¶æœˆ
- **6m**: 6ãƒ¶æœˆ
- **1y**: 1å¹´
- **3y**: 3å¹´
- **all**: å…¨æœŸé–“

### å®Ÿè£…æˆ¦ç•¥
1. **å®šæœŸãƒãƒƒãƒå‡¦ç†**: æ¯æ—¥æ·±å¤œã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—
2. **ä¸¦è¡Œå‡¦ç†**: å„æœŸé–“ã®é›†è¨ˆã‚’ä¸¦è¡Œå®Ÿè¡Œ
3. **é †ä½å¤‰å‹•è¿½è·¡**: å‰å›ã¨ã®æ¯”è¼ƒã§å¤‰å‹•è¨˜éŒ²
4. **å±¥æ­´ä¿æŒ**: é•·æœŸçš„ãªé †ä½å¤‰å‹•ã®å¯è¦–åŒ–

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦.md)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯.md)
- [é–‹ç™ºç’°å¢ƒ](é–‹ç™ºç’°å¢ƒ.md)
- [é–‹ç™ºãƒ•ãƒ­ãƒ¼](é–‹ç™ºãƒ•ãƒ­ãƒ¼.md)