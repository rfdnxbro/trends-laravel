# 機能仕様

## 概要
技術コミュニティでの企業影響力を定点観測するWebアプリケーションの機能仕様書です。

## 認証・権限
- **招待制サイト**: 招待を受けた人のみアクセス可能
- **権限レベル**: 
  - 一般ユーザー: 閲覧・検索機能
  - 管理者: データ管理・ユーザー管理機能

## データ収集システム（MVP）

### 収集頻度
- **1時間ごと**にスクレイピング実行

### 対象サイト・企業特定方法

#### はてなブックマーク
- **URL**: https://b.hatena.ne.jp/hotentry/it
- **企業特定**: テックブログのドメインで特定
- **自動登録条件**: ITカテゴリのホットエントリーに掲載された記事のドメイン

#### Qiita
- **URL**: https://qiita.com/trend
- **企業特定**: Organization投稿をスクレイピング
- **自動登録条件**: トレンドに掲載された記事のOrganization

#### Zenn
- **URL**: https://zenn.dev/ (Techカテゴリ)
- **企業特定**: Publication投稿をスクレイピング
- **自動登録条件**: Techカテゴリに掲載された記事のPublication

### 収集データ項目
- 記事タイトル
- URL
- 投稿日時
- 著者情報
- エンゲージメント数（いいね、ブックマーク等）
- 記事の技術タグ・カテゴリ

## 企業影響力ランキング

### 算出ロジック（3パターン検討中）
1. **表示回数カウント**: 各サイトに表示された回数の単純合計
2. **いいね数カウント**: いいね数の合計
3. **ポイント加算方式**: いいね数に応じたポイント制
   - 10以上: +1ポイント
   - 100以上: +5ポイント
   - 1000以上: +10ポイント等

### 技術カテゴリ
- **対象**: 全技術カテゴリ
  - プログラミング言語
  - フレームワーク
  - インフラ技術
  - データベース
  - AI/ML、ブロックチェーン等

## データベース設計

### 企業マスタ
- 企業ID
- 企業名
- 作成日時
- 更新日時

### ブログテーブル（企業マスタと1対多）
- ブログID
- 企業ID（外部キー）
- ドメイン名
- ブログ名
- 作成日時
- 更新日時

### 企業自動登録
- **条件**: 各サイトのトレンドに新しいドメイン・Organization・Publicationが掲載
- **処理**: 企業マスタとブログテーブルに自動登録
- **URL変更対応**: ブログテーブルでドメイン変更・削除に対応

## フロントエンド機能

### 基本機能
- **企業影響力ランキング表示**: リアルタイムでのランキング表示
- **期間指定**: 過去1ヶ月、3ヶ月、1年等の期間選択
- **企業詳細ページ**: 投稿履歴、技術スタックの変遷等
- **技術キーワード分析**: 注目技術と企業の関連性を可視化

### 管理機能（管理者のみ）
- **企業マスタ管理**: 企業情報の手動修正・削除
- **ブログドメイン管理**: ドメイン情報の手動修正・削除
- **スクレイピング状況確認**: 実行ログとエラー確認
- **ユーザー管理**: 招待・権限変更・削除

## 開発優先度

### MVP（最小機能）
1. **データ収集システム**: スクレイピング機能の実装
2. **企業自動登録**: 新規企業の自動検出・登録
3. **基本認証**: 招待制ユーザー管理

### 次期開発
1. **ランキング表示**: 企業影響力ランキング
2. **企業詳細ページ**: 詳細分析機能
3. **管理画面**: データ管理機能

## 技術要件
- **バックエンド**: Laravel（キューシステムでスクレイピング非同期実行）
- **フロントエンド**: React + Tailwind CSS
- **データベース**: PostgreSQL（時系列データ処理）
- **本番環境**: Laravel Cloud

## スクレイピング実装方針

### 定期実行システム
- **Laravel Scheduler**: 1時間ごとの定期実行
- **キューシステム**: 非同期でのスクレイピング処理
- **Job分散**: 各サイト別のジョブで並列実行

### 技術スタック
- **Guzzle HTTP**: HTTPリクエスト処理
- **Goutte**: DOMスクレイピング（Symfony DomCrawler）
- **Laravel HTTP Client**: 簡単なHTTPクライアント

### アーキテクチャ構成
```
Laravel Scheduler (hourly)
 ↓
ScrapingJob (Main)
 ├─ HatenaScrapingJob
 ├─ QiitaScrapingJob  
 └─ ZennScrapingJob
```

### レイヤー構成
- **Job層**: 各サイトのスクレイピング処理
- **Service層**: スクレイピングロジック
- **Repository層**: データベース操作
- **Model層**: Eloquentモデル

### エラー処理・監視
- **Retry機能**: 3回まで自動リトライ
- **Failed Job Queue**: 失敗したジョブの管理
- **ログ記録**: 各サイトのスクレイピング状況記録
- **Horizon**: キューの監視・管理
- **Laravel Telescope**: デバッグ・パフォーマンス監視