# 開発環境

## 初期セットアップ

### 必要なソフトウェア

- **PHP**: 8.2以上（最新LTS推奨）
- **Composer**: 最新版
- **Node.js**: 18.x以上（LTS推奨）
- **npm**: Node.jsに含まれる
- **PostgreSQL**: 15.x以上
- **Redis**: 6.x以上（キューシステム用）

### プロジェクトセットアップ

```bash
# リポジトリのクローン
git clone <repository-url>
cd trends-laravel

# PHP依存関係のインストール
composer install

# Node.js依存関係のインストール
npm install

# 環境ファイルのコピー
cp .env.example .env

# アプリケーションキーの生成
php artisan key:generate

# データベースマイグレーション
php artisan migrate

# フロントエンドアセットのビルド
npm run build
```

### 開発サーバー起動

```bash
# Laravel開発サーバー起動
php artisan serve

# フロントエンドアセットのホットリロード（別ターミナル）
npm run dev

# キューワーカー起動（別ターミナル）
php artisan queue:work

# Horizon起動（キュー監視、別ターミナル）
php artisan horizon
```

## テスト環境

### テストフレームワーク

- **PHPUnit**: PHP用テストフレームワーク
- **テストカバレッジ目標**: 95%

### テスト実行

```bash
# 全テスト実行
php artisan test

# 特定のテスト実行
php artisan test --filter TestName
```

## コード品質管理

### コードスタイル

- **Laravel Pint**: コードスタイルチェック・自動修正

```bash
# スタイルチェック
vendor/bin/pint

# ドライラン（確認のみ）
vendor/bin/pint --test
```

### 静的解析

- **PHPStan**: 静的解析ツール

```bash
# 静的解析実行
vendor/bin/phpstan analyse
```

## フロントエンド開発

### 必要なツール

- **React 19**: UIフレームワーク ✅ **実装完了**
- **TypeScript**: 型安全な開発 ✅ **実装完了**
- **React Router v7**: フロントエンドルーティング ✅ **実装完了**
- **React Query v5**: データ状態管理 ✅ **実装完了**
- **Tailwind CSS v4**: CSSフレームワーク ✅ **実装完了**
- **Axios**: HTTPクライアント ✅ **実装完了**
- **Vite**: ビルドツール（高速な開発サーバー） ✅ **実装完了**

### 開発用ビルド

```bash
# 開発用ビルド（ホットリロード）
npm run dev

# 本番用ビルド
npm run build
```

### フロントエンドプロジェクト構成

```
resources/js/
├── app.tsx                    # エントリーポイント
├── styles/
│   └── app.css               # Tailwind CSS + カスタムスタイル
├── components/
│   ├── App.tsx               # メインアプリケーション
│   ├── Layout.tsx            # レイアウトコンポーネント
│   ├── Header.tsx            # ヘッダーコンポーネント
│   └── Sidebar.tsx           # サイドバーコンポーネント
├── pages/
│   ├── Dashboard.tsx         # ダッシュボードページ
│   └── CompanyDetail.tsx     # 企業詳細ページ
├── services/
│   └── api.ts               # API クライアント（Axios）
├── types/
│   └── index.ts             # TypeScript 型定義
├── hooks/
│   └── useApi.ts            # カスタムフック
└── utils/
    └── index.ts             # ユーティリティ関数
```

### フロントエンド起動手順

```bash
# 1. Laravel開発サーバー起動
php artisan serve

# 2. Vite開発サーバー起動（別ターミナル）
npm run dev

# 3. ブラウザでアクセス
# http://localhost:8000
```

### フロントエンド機能

- ✅ **企業影響力ダッシュボード**: 統計情報・上位企業ランキング表示
- ✅ **企業詳細ページ**: 企業情報・プラットフォーム連携・記事一覧
- ✅ **レスポンシブデザイン**: モバイル・タブレット・デスクトップ対応
- ✅ **API統合**: Laravel API との完全連携
- ✅ **エラーハンドリング**: 404・500エラーの適切な表示
- ✅ **ローディング表示**: データ取得中のスピナー表示

## 環境設定

### データベース設定

1. **PostgreSQLのインストールと起動**
   ```bash
   # macOS (Homebrew)
   brew install postgresql
   brew services start postgresql
   
   # Ubuntu/Debian
   sudo apt-get install postgresql postgresql-contrib
   sudo systemctl start postgresql
   
   # データベースとユーザー作成
   sudo -u postgres psql
   CREATE DATABASE trends;
   CREATE USER trends_user WITH PASSWORD 'your_password';
   GRANT ALL PRIVILEGES ON DATABASE trends TO trends_user;
   \q
   ```

### Redis設定

1. **Redisのインストールと起動**
   ```bash
   # macOS (Homebrew)
   brew install redis
   brew services start redis
   
   # Ubuntu/Debian
   sudo apt-get install redis-server
   sudo systemctl start redis-server
   ```

2. **Redis接続確認**
   ```bash
   # Redis接続テスト
   redis-cli ping
   # 応答: PONG
   ```

2. **データベースとユーザーの作成**
   ```bash
   # PostgreSQLに接続
   sudo -u postgres psql
   
   # データベースとユーザー作成
   CREATE DATABASE trends;
   CREATE USER trends_user WITH PASSWORD 'your_password';
   GRANT ALL PRIVILEGES ON DATABASE trends TO trends_user;
   \q
   ```

3. **`.env`ファイルの設定**
   ```bash
   # アプリケーション基本設定
   APP_NAME="DevCorpTrends"
   APP_ENV=local
   APP_KEY=base64:your_generated_key
   APP_DEBUG=true
   APP_URL=http://localhost:8000
   
   # 言語設定
   APP_LOCALE=ja
   APP_FALLBACK_LOCALE=ja
   APP_FAKER_LOCALE=ja_JP
   
   # データベース設定（PostgreSQL）
   DB_CONNECTION=pgsql
   DB_HOST=127.0.0.1
   DB_PORT=5432
   DB_DATABASE=trends
   DB_USERNAME=trends_user
   DB_PASSWORD=your_password
   
   # Redis設定
   REDIS_HOST=127.0.0.1
   REDIS_PASSWORD=null
   REDIS_PORT=6379
   
   # キューシステム設定
   QUEUE_CONNECTION=database
   
   # フロントエンド設定
   VITE_APP_NAME="${APP_NAME}"
   ```

### SQLite設定（テスト・簡易開発用）

```bash
# SQLiteデータベースファイル作成
touch database/database.sqlite

# .envファイルでSQLite設定に変更
DB_CONNECTION=sqlite
# 他のDB_*設定はコメントアウト
```

### スクレイピング設定

1. **はてなブックマークスクレイピングテスト**
   ```bash
   # データを保存せずに動作確認（推奨）
   php artisan scrape:hatena --dry-run
   
   # データベースに保存して実行
   php artisan scrape:hatena
   
   # スクレイピングJobの手動実行（従来方法）
   php artisan queue:work --once --queue=scraping
   
   # Tinkerでの直接操作
   php artisan tinker
   $scraper = new App\Services\HatenaBookmarkScraper();
   $entries = $scraper->scrapePopularItEntries();
   ```

2. **Qiitaスクレイピングテスト**
   ```bash
   # データを保存せずに動作確認（推奨）
   php artisan scrape:qiita --dry-run
   
   # データベースに保存して実行
   php artisan scrape:qiita
   
   # Tinkerでの直接操作
   php artisan tinker
   $scraper = new App\Services\QiitaScraper();
   $articles = $scraper->scrapeTrendingArticles();
   ```

3. **Horizon設定**
   ```bash
   # Horizonの設定ファイル公開
   php artisan horizon:install
   
   # Horizonダッシュボードアクセス
   # http://localhost:8000/horizon
   ```

### トラブルシューティング

#### よくある問題と解決策

1. **データベース接続エラー**
   ```bash
   # PostgreSQLが起動しているか確認
   brew services list | grep postgresql
   
   # 接続テスト
   php artisan tinker
   DB::connection()->getPdo();
   ```

2. **Composer依存関係エラー**
   ```bash
   # Composerキャッシュクリア
   composer clear-cache
   composer install --no-cache
   ```

3. **npmビルドエラー**
   ```bash
   # node_modulesの再インストール
   rm -rf node_modules package-lock.json
   npm install
   ```

## 関連ドキュメント

- [技術スタック](技術スタック)
- [開発フロー](開発フロー)
- [CI/CD](CI-CD)